# 第十五章：推理增强技术


> 让AI学会"像人一样思考"

---

## 15.1 Chain-of-Thought（CoT）

### 15.1.1 核心思想

**CoT**：显式引导模型逐步推理

```

问题：一个篮子有5个苹果，拿走2个，还剩几个？


直接回答：3个

CoT推理：
1. 初始有5个苹果
2. 拿走2个
3. 剩下：5 - 2 = 3个
4. 答案：3个
```


### 15.1.2 Zero-Shot CoT

```

提示词："让我们一步步思考这个问题：..."

```

### 15.1.3 Few-Shot CoT

```

提示词示例：


Q: 罗杰有5个球，扔掉3个...
A: 初始5个球，扔掉3个，剩下2个。答案：2

Q: 一本书20页，每天读5页...
A: ...
```


---

## 15.2 Self-Consistency

### 15.2.1 核心思想

**自洽性**：多次生成推理路径，选择最一致的答案

```

问题：12 + 15 = ?


路径1: 10 + 2 = 12，12 + 15 = 27 → 答案27
路径2: 12 + 15 = 27，验证无误 → 答案27
路径3: 12 + 15 = 27 → 答案27

投票：27（3票一致）
```


### 15.2.2 实现方法

```python
def self_consistency(model, question, n_samples=5):
    answers = []
    for _ in range(n_samples):
        prompt = "让我们一步步思考：" + question
        answer = model.generate(prompt)
        answers.append(answer)

    # 投票
    from collections import Counter
    most_common = Counter(answers).most_common(1)[0][0]

    return most_common
```


---

## 15.3 Tree-of-Thought（ToT）

### 15.3.1 核心思想

**树状思维**：将推理过程表示为树结构，探索多条路径

```

                    [问题]
                     |
            ┌────────┼────────┐
           [路径1]  [路径2]  [路径3]
             |        |        |
           [A1]    [A2]    [A3]
             |        |        |
           [B1]    [B2]    [B3]


评估：B1(好), B2(差), B3(中)
选择：B1
```


### 15.3.2 搜索策略

- **广度优先（BFS）**：逐层探索
- **深度优先（DFS）**：沿一条路径深入
- **最佳优先**：评估引导

---

## 15.4 Graph-of-Thought（GoT）

### 15.4.1 核心思想

**图状思维**：推理路径可以分叉和合并

```

[A] → [B] → [C] → [E]
       ↘  → [D] → [E]


A是起点，E是终点，多条路径共享中间推理
```


### 15.4.2 聚合操作

| 操作 | 描述 |
|------|------|
| 聚合 | 合并多个节点的信息 |
| 提炼 | 选择最佳信息 |
| 传播 | 传递信息到下游 |

---

## 15.5 推理技术对比

| 技术 | 结构 | 优势 | 适用场景 |
|------|------|------|----------|
| CoT | 线性 | 简单 | 基础推理 |
| Self-Consistency | 多路径并行 | 提升准确率 | 数学、逻辑 |
| ToT | 树状 | 系统探索 | 复杂推理 |
| GoT | 图状 | 灵活共享 | 多步骤问题 |

---

## 本章小结

**核心概念**：

1. ✅ CoT：逐步显式推理
2. ✅ Self-Consistency：多路径投票
3. ✅ ToT：树状探索
4. ✅ GoT：图状聚合
5. ✅ 推理提升：从直觉到系统思考

---

## 思考题

1. CoT相比直接回答有什么优势？
2. Self-Consistency适合哪些任务？
3. ToT和GoT的区别是什么？
4. 如何选择合适的推理策略？

---

## 下一步

下一章我们将学习**多智能体系统**：

- PlanGEN框架
- 智能体协作
- 任务分解与集成
- 自主智能体系统

准备好探索多智能体的协作世界了吗？
